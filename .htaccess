<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# ============================================
# REDIRECTS 301 - WordPress a Angular URLs
# ============================================
# Redirigir URLs antiguas de WordPress con fecha a nuevas URLs de Angular
# Ejemplo: /2025/08/31/slug/ → /post/slug

# Redirect con www a sin www (normalización)
RewriteCond %{HTTP_HOST} ^www\.hackeruna\.com [NC]
RewriteRule ^(.*)$ https://hackeruna.com/$1 [R=301,L]

# Redirect URLs de WordPress con fecha a nuevo formato
# Patrón: /YYYY/MM/DD/slug/ → /post/slug
RewriteRule ^[0-9]{4}/[0-9]{2}/[0-9]{2}/(.+)/?$ /post/$1 [R=301,L]

# ============================================
# Angular SPA Routing
# ============================================
# Servir archivos estáticos directamente (no pasar a Angular)
RewriteRule ^llms\.txt$ - [L]
RewriteRule ^robots\.txt$ - [L]
RewriteRule ^sitemap\.xml$ - [L]
RewriteRule ^ads\.txt$ - [L]

# Redirigir todas las rutas a index.html para que Angular maneje el routing
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]
</IfModule>

# Force correct MIME types for static files
<IfModule mod_mime.c>
  AddType text/plain .txt
  AddType application/xml .xml
</IfModule>

# Specific headers for llms.txt
<Files "llms.txt">
  ForceType text/plain
  Header set Content-Type "text/plain; charset=UTF-8"
</Files>

# Compresión Gzip
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml+rss application/atom+xml image/svg+xml
  AddEncoding gzip .gz
  AddType application/gzip .gz
</IfModule>

# Cache Headers
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Cache de 1 año para assets versionados
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType font/truetype "access plus 1 year"
  ExpiresByType font/opentype "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
  
  # Cache de 1 día para HTML
  ExpiresByType text/html "access plus 1 day"
  
  # No cachear JSON
  ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# ETag
<IfModule mod_headers.c>
  Header unset ETag
  FileETag None
</IfModule>
